<div ref:textArea {...attrs}>
  {#if leading_icon}
    <Icon ref:leadingIcon class="mdc-text-field__icon" tabindex="0" role="button">{leading_icon}</Icon>
  {/if}
  <textarea id="{id}" name="{name}" class="mdc-text-field__input" disabled={disabled} rows="{rows}" cols="{cols}" {...inputAttrs}>{value}</textarea>
  {#if hint_text}
    <label class="mdc-floating-label" for="{id}">{hint_text}</label>
  {/if}
  {#if trailing_icon}
    <Icon ref:trailingIcon class="mdc-text-field__icon" tabindex="0" role="button">{trailing_icon}</Icon>
  {/if}
  {#if outlined}
    <div class="mdc-notched-outline">
      <svg>
        <path class="mdc-notched-outline__path"/>
      </svg>
    </div>
    <div class="mdc-notched-outline__idle"></div>
  {/if}
</div>
{#if helper_text}
<p ref:helperText id="{id}-helper-text" class="mdc-text-field-helper-text" aria-hidden="true">
  {helper_text}
</p>
{/if}
<script>
import {MDCTextField} from "@material/textfield";
import {MDCTextFieldIcon} from '@material/textfield/icon';

import {processAttributes, formatString} from "./helpers.js";
const iconsKeys = ["trailing_icon", "leading_icon"];
export default {
    components: {
        Icon: "./Icon.html"
    },
    oncreate() {
        this.mdcComponent = new MDCTextField(this.refs.textArea);
    },
    onstate({current, changed}) {
        for (let key of mdcAttrs) {
            if (changed[key]) {
                this.mdcComponent[key] = current[key];
            }
        }
        for (let key of ["leading_icon", "trailing_icon", "helper_text", "outlined", "hint_text"]) {
            if (changed[key]) {
                this.mdcComponent.destroy();
                this.mdcComponent = new MDCTextField(this.refs.textArea);
                break;
            }
        }
    },
    ondestroy() {
        this.mdcComponent.destroy();
    },
    computed: {
        inputAttrs ({placeholder, helper_text, id}) {
            var result = {};
            if (helper_text) {
                let elem = id+"-helper-text";
                result["aria-controls"] = elem;
                result["aria-describedby"] = elem;
            }
            return result;
        },
        attrs (attributes) {
            let result = Object.assign({}, attributes);
            let cls = "mdc-text-field";
            result.textarea = true;
            for (let key of ["box", "textarea", "dense", "fullwidth", "outlined", "disabled", "focused", ...iconsKeys]) {
                if (result[key]) {
                    if (iconsKeys.includes(key)) {
                        key = "with-"+key;
                    }
                    classes.push(cls+"--"+formatString(key));
                }
                delete result[key];
            }
            for (let key of ["attrs", "id", "name", "type", "helper_text", "rows", "cols", "inputAttrs", ...mdcAttrs]) {
                delete result[key];
            }
            if (result["class"]) {
                classes.push(result["class"]);
            }
            result["class"] = classes.join(" ");
            return processAttributes(result);
        }
    }
};
</script>
