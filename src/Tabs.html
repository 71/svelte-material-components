<nav ref:tabs {...attrs}>
  <slot></slot>
  <span class="mdc-tab-bar__indicator"></span>
</nav>
<script>
import {MDCTabBar} from '@material/tabs';
import {formatString, processAttributes} from './helpers.js';
export default {
    oncreate() {
        if (this.root && this.root.getTabsComponent) {
            this.mdcComponent = this.root.getTabsComponent();
        } else {
            this.mdcComponent = new MDCTabBar(this.refs.tabs);
        }
        this.mdcComponent.listen("MDCTabBar:change", () => {
            this.fire("change", {"active_tab_index": this.mdcComponent.active_tab_index});
            this.set({"active_tab_index": this.mdcComponent.active_tab_index});
        })
    },
    ondestroy() {
        if (!this.root || !this.root.getTabsComponent) {
            this.mdcComponent.destroy();
        }
    },
    onstate({current, changed}) {
        if (changed.active_tab_index && this.mdcComponent.active_tab_index !== current.active_tab_index) {
            this.mdcComponent.active_tab_index = current.active_tab_index;
        }
    },
    computed: {
        attrs (attributes) {
            let result = Object.assign({}, attributes);
            let cls ="mdc-tab-bar";
            let classes = [cls];
            for (let key of ["icon_tab_bar", "icons_with_text"]) {
                if (result[key]) {
                    classes.push(cls+"--"+formatString(key));
                }
                delete result[key];
            }
            delete result.attrs;
            delete result.active_tab_index;
            if (result["class"]) {
                classes.push(result["class"]);
            }
            result["class"] = classes.join(" ");
            return processAttributes(result);
        }
    }
}
</script>
